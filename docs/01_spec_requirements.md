# Web-to-Book Reader 仕様書（要件定義）v0.1

本書は React Native（Expo）+ Supabase を前提にした「Web-to-Book Reader」の要件定義ドラフトです。実装・見積・優先度の基準として利用します。

## 1. 目的・コンセプト
- **目的**: Web記事を「本」として再定義し、集中して読める読書体験（ページめくり、進捗、コレクション）を提供する。
- **価値**:
  - Webのノイズ（広告/ナビ/関連記事）を除去し本文に集中できる
  - スクロールではなくページ単位で読める
  - 進捗が端末間で同期され、途中から再開できる
  - オフラインでも読める（キャッシュ）

## 2. 対象ユーザー・ユースケース
- **対象**: 長文の技術記事、コラム、ドキュメントを腰を据えて読みたいユーザー
- **代表シナリオ**:
  - ブラウザ共有からURLを保存 → 自動で本文抽出 → 本棚に追加 → リーダーで読む
  - スマホで途中まで読んだ続きをタブレットで再開
  - 一度取得した記事をオフラインで読む

## 3. 対応プラットフォーム
- iOS / Android（Expo）
- Web（将来拡張の余地。初期はモバイル優先）

## 4. スコープ（MVPと将来）
### 4.1 MVP（Phase 1〜3相当）
- URL登録（手入力 + 共有受け取り）
- 本棚（カード/リスト、未読/読了/アーカイブ）
- Edge Function による本文抽出（Readability）
- リーダー（ページめくりUI、設定：フォント/行間/テーマ）
- 進捗保存（自動、同期）

### 4.2 追加（Phase 4+）
- オフラインキャッシュ（全文/画像/ページ分割結果）
- コレクション（フォルダ、色）
- 検索、タグ、ハイライト、メモ、TTS など（検討枠）

## 5. 機能要件
### A. ライブラリ管理（本棚）
- **URL登録**
  - アプリ内入力（URL貼り付け）
  - OS共有メニューから受け取り（iOS Share Extension / Android share intent）
  - 受付時のバリデーション：`http/https`、長さ、同一URL重複の扱い（仕様は設計書参照）
- **本棚表示**
  - 表示モード：カード / リスト
  - 表示情報：タイトル、サイト名、アイキャッチ、追加日、ステータス、進捗（%）
  - 取得状態：抽出中 / 成功 / 失敗（再試行導線）
- **ステータス管理**
  - 未読 / 読了 / アーカイブ
  - 本棚フィルタ・ソート（追加日/最終読了日/サイト名など）
- **削除**
  - ライブラリから削除（DBから削除 + キャッシュ削除）

### B. リーダー（読書）
- **本文抽出結果の表示**
  - 記事本文（テキスト + 画像）
  - 見出し構造の保持（h1/h2/h3）
  - 画像は「本文に必要なもの」を表示（遅延読み込みは任意）
- **ページネーション**
  - スクロールではなく、左右タップ/スワイプでページ移動
  - ページ番号、残り、章タイトル等の表示（任意）
  - 端末回転/フォント変更時は再ページ分割（進捗復元は「アンカー方式」も検討）
- **カスタマイズ**
  - フォントサイズ、行間、余白、フォント種別（任意）
  - テーマ：ライト/セピア/ダーク
- **進捗保存**
  - 自動保存：ページ遷移時・一定間隔・アプリ離脱時
  - 進捗は端末間同期（リアルタイム/準リアルタイム）

### C. データ同期・オフライン
- **同期**
  - Supabase（Postgres + Realtime）で `reading_progress` を同期
  - 競合時は「last_write_wins（更新時刻優先）」を基本（設計書で定義）
- **オフライン**
  - 抽出済み記事の本文を端末にキャッシュ
  - オフライン中の進捗更新はローカルにキューし、オンライン復帰時に反映

## 6. 非機能要件
- **性能**
  - 本文抽出はEdge Function側で実行し、アプリ側は軽量に保つ
  - リーダーはページめくりが60fpsに近い体験（目標）
- **信頼性**
  - 抽出失敗時の再試行、ログ取得、ユーザーに説明可能なエラー表現
- **セキュリティ/プライバシー**
  - 読書データはユーザー単位で分離（RLS）
  - 外部URLフェッチ時のSSRF/巨大レスポンス対策（設計書参照）
- **可観測性**
  - Edge Functionのログ（失敗理由、HTTPステータス、サイズなど）

## 7. 受け入れ基準（代表）
- 共有/入力からURLを登録でき、数秒以内に本棚に「抽出済み」として表示される
- リーダーで左右スワイプでページ遷移できる
- 進捗が別端末で開いた際に復元される
- オフラインでも過去に読んだ記事が開ける（Phase 4）

